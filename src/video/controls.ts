import { MessageType } from '@cve-ts/dictionary'

import video from './element'

import { send } from '../liaison/emitter'
import { emitDebugEvent } from '../player/emitter'

export function playVideoStream() {
  video.play().catch(() => {
    emitDebugEvent('play', 'error')
  })
  // Request Initial Settings
  send(new Uint8Array([MessageType.RequestInitialSettings]).buffer)
  // Request Quality Control
  send(new Uint8Array([MessageType.RequestQualityControl]).buffer)
  emitDebugEvent('play', 'start')
}

export function setVideoEnabled(enabled: boolean) {
  const media = video.srcObject as MediaStream
  media.getTracks().forEach((track) => (track.enabled = enabled))
}
