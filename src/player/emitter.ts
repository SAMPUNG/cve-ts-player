import { player } from './custom-element'

import type {
  CveDebugDetail,
  CveDebugName,
  CveEventDetail,
  CveEventType,
} from '~/types/player/emitter'

export function emitDebugEvent<T extends CveDebugName>(
  type: T,
  data: CveDebugDetail[T]
) {
  if (!player) {
    return
  }

  const detail: Partial<CveDebugDetail> = { [type]: data }
  const event = new CustomEvent('debug', { detail })
  player.dispatchEvent(event)
}

export function emitEvent<T extends CveEventType>(
  type: T,
  detail: CveEventDetail[T]
) {
  if (!player) {
    return
  }

  const HANDLER_LIMIT = ['init', 'measure', 'pick', 'render']
  if (HANDLER_LIMIT.includes(type) && !player.ready) {
    return
  }

  const event = new CustomEvent(type, { detail })
  player.dispatchEvent(event)
  console.log(
    '%c[ce]',
    'background: ivory; color: black',
    'Dispatch Event ===> ',
    type,
    detail
  )
}
