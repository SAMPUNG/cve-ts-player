import { player } from './custom-element'

import type {
  CveDebugDetail,
  CveDebugName,
  CveEventDetail,
  CveEventType,
} from '~/types/player/emitter'

export function emitDebugEvent<T extends CveDebugName>(
  type: T,
  data: CveDebugDetail[T]
) {
  if (!player) {
    return
  }

  const detail: Partial<CveDebugDetail> = { [type]: data }
  const event = new CustomEvent('debug', { detail })
  player.dispatchEvent(event)

  if (player.getAttribute('debug') !== null) {
    console.log(
      '%c[ce]',
      'background: golden; color: black',
      'Dispatch Debug Event ===> ',
      type,
      detail
    )
  }
}

export function emitEvent(
  event: Event
) {
  if (!player) {
    return
  }

  player.dispatchEvent(event)
  console.log(
    '%c[ce]',
    'background: ivory; color: black',
    'Dispatch Event ===> ',
    event
  )
}

export function emitCustomEvent<T extends CveEventType>(
  type: T,
  detail: CveEventDetail[T]
) {
  if (!player) {
    return
  }

  const HANDLER_LIMIT = ['init', 'measure', 'pick', 'render']
  if (HANDLER_LIMIT.includes(type) && !player.ready) {
    return
  }

  const event = new CustomEvent(type, { detail })
  player.dispatchEvent(event)
  console.log(
    '%c[ce]',
    'background: aqua; color: black',
    'Dispatch Custom Event ===> ',
    type,
    detail
  )
}
